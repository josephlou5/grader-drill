{"ast":null,"code":"var _jsxFileName = \"/Users/josephlou/Documents/Files/Princeton/grading/grader-drill-app/client/src/App/components/questionEditView.jsx\";\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { ResizeTextareas } from \"../shared\";\nimport { getAllQuestions, getQuestion, updateQuestion } from \"../api\";\nimport QuestionTextField from \"./questionTextField\";\nimport CodeField from \"./codeField\";\nimport AnswerField from \"./answerField\";\nimport RubricField from \"./rubricField\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass QuestionEditView extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleQuestionType = questionType => {\n      switch (questionType) {\n        case \"Comment\":\n          this.setState({\n            questionType,\n            hasCodeField: true,\n            canToggleCodeField: false,\n            hasAnswerField: true\n          });\n          break;\n\n        case \"Highlight\":\n          this.setState({\n            questionType,\n            hasCodeField: true,\n            canToggleCodeField: false,\n            hasAnswerField: false\n          });\n          break;\n\n        case \"Multiple Choice\":\n          this.setState({\n            questionType,\n            canToggleCodeField: true,\n            hasAnswerField: true\n          });\n          break;\n\n        default:\n          return;\n      }\n    };\n\n    this.handleTextChange = questionText => {\n      this.setState({\n        questionText\n      });\n    };\n\n    this.handleToggleCodeField = () => {\n      if (this.state.canToggleCodeField) {\n        this.setState({\n          hasCodeField: !this.state.hasCodeField\n        });\n      }\n    };\n\n    this.handleCodeChange = code => {\n      // see if any highlights were deleted\n      const lines = code.split(\"\\n\");\n      const numLines = lines.length;\n      const lineLengths = lines.map(line => line.length);\n      let removing = [];\n      const highlights = this.state.highlights.flatMap((h, i) => {\n        let highlight = { ...h\n        };\n        let {\n          startLine,\n          startChar,\n          endLine,\n          endChar\n        } = highlight;\n        if (startLine >= numLines) return [];\n\n        if (endLine >= numLines) {\n          endLine = numLines - 1;\n          endChar = lineLengths[endLine];\n        }\n\n        if (startLine === endLine) {\n          // highlight doesn't exist on this line anymore\n          if (startChar >= lineLengths[startLine]) {\n            removing.unshift(i);\n            return [];\n          } // the end of the highlight got cut off\n\n\n          if (endChar >= lineLengths[endLine]) {\n            highlight[\"endChar\"] = lineLengths[endLine];\n          }\n\n          return [highlight];\n        }\n\n        if (startChar >= lineLengths[startLine]) {\n          // go to start of next non-empty line\n          do {\n            startLine++;\n          } while (lineLengths[startLine] === 0);\n\n          if (startLine >= numLines) return [];\n          startChar = 0;\n        }\n\n        if (endChar > lineLengths[endLine]) {\n          // go to end of last non-empty line\n          while (lineLengths[endLine] === 0) {\n            endLine--;\n          }\n\n          if (endLine < 0) return [];\n          endChar = lineLengths[endLine];\n        }\n\n        if (startLine > endLine) return [];\n        Object.assign(highlight, {\n          startLine,\n          startChar,\n          endLine,\n          endChar\n        });\n        return [highlight];\n      });\n      this.setState({\n        code,\n        highlights\n      });\n    };\n\n    this.handleAddHighlight = (question, highlight) => {\n      let highlights = [...this.state.highlights];\n      highlights.push(highlight);\n      this.setState({\n        highlights\n      });\n    };\n\n    this.handleClearHighlights = () => {\n      this.setState({\n        highlights: []\n      });\n    };\n\n    this.handleChangeHighlightText = (index, text) => {\n      let highlights = [...this.state.highlights];\n      highlights[index][\"text\"] = text;\n      this.setState({\n        highlights\n      });\n    };\n\n    this.handleDeleteHighlight = (question, highlightIndex) => {\n      let highlights = [...this.state.highlights];\n      highlights.splice(highlightIndex, 1);\n      this.setState({\n        highlights\n      });\n    };\n\n    this.handleAddAnswerChoice = () => {\n      let answerChoices = [...this.state.answerChoices];\n      answerChoices.push(\"\");\n      this.setState({\n        answerChoices\n      });\n    };\n\n    this.handleChangeAnswerChoice = (index, answerChoice) => {\n      let answerChoices = [...this.state.answerChoices];\n      answerChoices[index] = answerChoice;\n      this.setState({\n        answerChoices\n      });\n    };\n\n    this.handleDeleteAnswerChoice = index => {\n      let answerChoices = [...this.state.answerChoices];\n      answerChoices.splice(index, 1);\n      let stateUpdate = {\n        answerChoices\n      };\n\n      if (index === this.state.correct) {\n        // deleting the correct choice, so no more correct choice\n        stateUpdate[\"correct\"] = null;\n      } else if (index < this.state.correct) {\n        // deleting one before the correct choice, so shift correct choice up\n        stateUpdate[\"correct\"] = this.state.correct - 1;\n      }\n\n      this.setState(stateUpdate);\n    };\n\n    this.handleSetCorrectAnswerChoice = index => {\n      this.setState({\n        correct: index\n      });\n    };\n\n    this.handleAddRubricItem = () => {\n      let rubric = [...this.state.rubric];\n      rubric.push({\n        points: 1,\n        text: \"\"\n      });\n      this.setState({\n        rubric\n      });\n    };\n\n    this.handleChangeRubricItemPoints = (index, points) => {\n      let rubric = [...this.state.rubric];\n      let rubricItem = { ...rubric[index]\n      };\n      let pointsNum = parseInt(points);\n\n      if (isNaN(pointsNum)) {\n        pointsNum = 0;\n      }\n\n      rubricItem[\"points\"] = pointsNum;\n      rubric[index] = rubricItem;\n      this.setState({\n        rubric\n      });\n    };\n\n    this.handleChangeRubricItemText = (index, text) => {\n      let rubric = [...this.state.rubric];\n      let rubricItem = { ...rubric[index]\n      };\n      rubricItem[\"text\"] = text;\n      rubric[index] = rubricItem;\n      this.setState({\n        rubric\n      });\n    };\n\n    this.handleDeleteRubricItem = index => {\n      let rubric = [...this.state.rubric];\n      rubric.splice(index, 1);\n      this.setState({\n        rubric\n      });\n    };\n\n    this.handleCancel = () => {\n      this.props.history.goBack();\n    };\n\n    this.validate = question => {\n      let formValid = true;\n\n      function setValid(elementId, isValid) {\n        document.getElementById(elementId).classList.toggle(\"is-invalid\", !isValid);\n        if (!isValid) formValid = false;\n      }\n\n      setValid(\"question-edit-text\", question.questionText.length > 0);\n\n      if (question.hasCodeField) {\n        setValid(\"question-edit-code\", question.code.length > 0);\n      }\n\n      if (question.questionType === \"Multiple Choice\") {\n        if (question.answerChoices.length === 0) {\n          setValid(\"question-edit-mc\", false);\n        } else {\n          if (question.correct == null) {\n            setValid(\"question-edit-mc-correct\", false);\n          }\n\n          question.answerChoices.forEach((text, index) => setValid(\"question-edit-mc-\" + index, text.length > 0));\n        }\n      } else {\n        if (question.rubric.length === 0) {\n          setValid(\"question-edit-rubric\", false);\n        } else {\n          question.rubric.forEach((item, index) => {\n            setValid(\"question-edit-rubric-points-\" + index, item.points && item.points !== 0);\n            setValid(\"question-edit-rubric-\" + index, item.text.length > 0);\n          });\n        }\n      }\n\n      return formValid;\n    };\n\n    this.handleSave = () => {\n      let question = {\n        id: this.state.id,\n        hasCodeField: this.state.hasCodeField,\n        hasAnswerField: this.state.hasAnswerField,\n        questionType: this.state.questionType,\n        questionText: this.state.questionText,\n        highlights: this.state.highlights\n      };\n\n      if (this.state.hasCodeField) {\n        question[\"code\"] = this.state.code;\n      }\n\n      switch (this.state.questionType) {\n        case \"Comment\":\n          question[\"answers\"] = this.state.highlights.map(() => \"\");\n        // fall through\n\n        case \"Highlight\":\n          question[\"rubric\"] = this.state.rubric;\n          break;\n\n        case \"Multiple Choice\":\n          Object.assign(question, {\n            answerChoices: this.state.answerChoices,\n            correct: this.state.correct\n          });\n          break;\n\n        default:\n          return;\n      }\n\n      if (!this.validate(question)) return;\n      updateQuestion(question);\n      this.props.history.push(\"/questions\");\n    };\n\n    this.state = {\n      hasCodeField: true,\n      canToggleCodeField: false,\n      hasAnswerField: true,\n      questionType: \"Comment\",\n      questionText: \"\",\n      code: \"\",\n      highlights: [],\n      answerChoices: [],\n      correct: null,\n      rubric: []\n    };\n\n    if (!props.newQuestion) {\n      this.state[\"needsQuestion\"] = true;\n    }\n  }\n\n  componentDidMount() {\n    if (!this.state.needsQuestion) return;\n    getQuestion(this.props.questionId, q => {\n      if (!q) {\n        this.setState({\n          invalidQuestion: true\n        });\n        return;\n      }\n\n      if (q.questionType === \"Multiple Choice\") {\n        q[\"canToggleCodeField\"] = true;\n      }\n\n      q[\"needsQuestion\"] = false;\n      this.setState(q);\n    });\n  }\n\n  render() {\n    if (this.state.needsQuestion) {\n      return /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Loading question...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 20\n      }, this);\n    } else if (this.state.invalidQuestion) {\n      return /*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Invalid question\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 20\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(ResizeTextareas, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: /*#__PURE__*/_jsxDEV(\"h1\", {\n            children: this.props.newQuestion ? \"New Question\" : \"Edit Question\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: /*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"Preview\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"btn-group\",\n        role: \"group\",\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: [\"Comment\", \"Highlight\", \"Multiple Choice\"].map(questionType => {\n          const idFor = \"type-\" + questionType.toLowerCase();\n          return /*#__PURE__*/_jsxDEV(React.Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"radio\",\n              className: \"btn-check\",\n              name: \"question-type\",\n              id: idFor,\n              checked: questionType === this.state.questionType,\n              onChange: () => this.handleQuestionType(questionType)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 342,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"btn btn-outline-primary\",\n              htmlFor: idFor,\n              children: questionType\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 357,\n              columnNumber: 37\n            }, this)]\n          }, questionType, true, {\n            fileName: _jsxFileName,\n            lineNumber: 341,\n            columnNumber: 33\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(QuestionTextField, {\n        editMode: true,\n        question: this.state,\n        onTextChange: this.handleTextChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 17\n      }, this), this.state.canToggleCodeField &&\n      /*#__PURE__*/\n      // todo: can change this into a toggle button instead of a checkbox\n      _jsxDEV(\"div\", {\n        className: \"form-check form-check-inline\",\n        style: {\n          marginLeft: \"10px\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          className: \"form-check-input\",\n          id: \"hasCodeField\",\n          defaultChecked: this.state.hasCodeField,\n          onChange: this.handleToggleCodeField\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"form-check-label\",\n          htmlFor: \"hasCodeField\",\n          children: \"Include code field\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 21\n      }, this), this.state.hasCodeField && /*#__PURE__*/_jsxDEV(CodeField, {\n        editMode: true,\n        question: this.state,\n        onCodeChange: this.handleCodeChange,\n        onAddHighlight: this.handleAddHighlight,\n        onDeleteHighlight: this.handleDeleteHighlight,\n        onClearHighlights: this.handleClearHighlights\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 21\n      }, this), this.state.hasAnswerField && /*#__PURE__*/_jsxDEV(AnswerField, {\n        editMode: true,\n        question: this.state,\n        onClearHighlights: this.handleClearHighlights,\n        onChangeHighlightText: this.handleChangeHighlightText,\n        onDeleteHighlight: this.handleDeleteHighlight,\n        onAddAnswerChoice: this.handleAddAnswerChoice,\n        onChangeAnswerChoice: this.handleChangeAnswerChoice,\n        onDeleteAnswerChoice: this.handleDeleteAnswerChoice,\n        onSetCorrectAnswerChoice: this.handleSetCorrectAnswerChoice\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 21\n      }, this), this.state.questionType !== \"Multiple Choice\" && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: /*#__PURE__*/_jsxDEV(RubricField, {\n            editMode: true,\n            question: this.state,\n            onAddRubricItem: this.handleAddRubricItem,\n            onChangeRubricItemPoints: this.handleChangeRubricItemPoints,\n            onChangeRubricItemText: this.handleChangeRubricItemText,\n            onDeleteRubricItem: this.handleDeleteRubricItem\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col\",\n          children: /*#__PURE__*/_jsxDEV(RubricField, {\n            previewMode: true,\n            question: this.state\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 424,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-danger m-2\",\n          onClick: this.handleCancel,\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 449,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-success m-2\",\n          onClick: this.handleSave,\n          children: \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 448,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(QuestionEditView);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/josephlou/Documents/Files/Princeton/grading/grader-drill-app/client/src/App/components/questionEditView.jsx"],"names":["React","Component","withRouter","ResizeTextareas","getAllQuestions","getQuestion","updateQuestion","QuestionTextField","CodeField","AnswerField","RubricField","QuestionEditView","constructor","props","handleQuestionType","questionType","setState","hasCodeField","canToggleCodeField","hasAnswerField","handleTextChange","questionText","handleToggleCodeField","state","handleCodeChange","code","lines","split","numLines","length","lineLengths","map","line","removing","highlights","flatMap","h","i","highlight","startLine","startChar","endLine","endChar","unshift","Object","assign","handleAddHighlight","question","push","handleClearHighlights","handleChangeHighlightText","index","text","handleDeleteHighlight","highlightIndex","splice","handleAddAnswerChoice","answerChoices","handleChangeAnswerChoice","answerChoice","handleDeleteAnswerChoice","stateUpdate","correct","handleSetCorrectAnswerChoice","handleAddRubricItem","rubric","points","handleChangeRubricItemPoints","rubricItem","pointsNum","parseInt","isNaN","handleChangeRubricItemText","handleDeleteRubricItem","handleCancel","history","goBack","validate","formValid","setValid","elementId","isValid","document","getElementById","classList","toggle","forEach","item","handleSave","id","newQuestion","componentDidMount","needsQuestion","questionId","q","invalidQuestion","render","marginLeft","idFor","toLowerCase"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,eAAT,QAAgC,WAAhC;AACA,SAASC,eAAT,EAA0BC,WAA1B,EAAuCC,cAAvC,QAA6D,QAA7D;AACA,OAAOC,iBAAP,MAA8B,qBAA9B;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,WAAP,MAAwB,eAAxB;AACA,OAAOC,WAAP,MAAwB,eAAxB;;;AAEA,MAAMC,gBAAN,SAA+BV,SAA/B,CAAyC;AACrCW,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN;;AADe,SAkCnBC,kBAlCmB,GAkCGC,YAAD,IAAkB;AACnC,cAAQA,YAAR;AACI,aAAK,SAAL;AACI,eAAKC,QAAL,CAAc;AACVD,YAAAA,YADU;AAEVE,YAAAA,YAAY,EAAE,IAFJ;AAGVC,YAAAA,kBAAkB,EAAE,KAHV;AAIVC,YAAAA,cAAc,EAAE;AAJN,WAAd;AAMA;;AACJ,aAAK,WAAL;AACI,eAAKH,QAAL,CAAc;AACVD,YAAAA,YADU;AAEVE,YAAAA,YAAY,EAAE,IAFJ;AAGVC,YAAAA,kBAAkB,EAAE,KAHV;AAIVC,YAAAA,cAAc,EAAE;AAJN,WAAd;AAMA;;AACJ,aAAK,iBAAL;AACI,eAAKH,QAAL,CAAc;AACVD,YAAAA,YADU;AAEVG,YAAAA,kBAAkB,EAAE,IAFV;AAGVC,YAAAA,cAAc,EAAE;AAHN,WAAd;AAKA;;AACJ;AACI;AAzBR;AA2BH,KA9DkB;;AAAA,SAgEnBC,gBAhEmB,GAgECC,YAAD,IAAkB;AACjC,WAAKL,QAAL,CAAc;AAAEK,QAAAA;AAAF,OAAd;AACH,KAlEkB;;AAAA,SAoEnBC,qBApEmB,GAoEK,MAAM;AAC1B,UAAI,KAAKC,KAAL,CAAWL,kBAAf,EAAmC;AAC/B,aAAKF,QAAL,CAAc;AAAEC,UAAAA,YAAY,EAAE,CAAC,KAAKM,KAAL,CAAWN;AAA5B,SAAd;AACH;AACJ,KAxEkB;;AAAA,SA0EnBO,gBA1EmB,GA0ECC,IAAD,IAAU;AACzB;AACA,YAAMC,KAAK,GAAGD,IAAI,CAACE,KAAL,CAAW,IAAX,CAAd;AACA,YAAMC,QAAQ,GAAGF,KAAK,CAACG,MAAvB;AACA,YAAMC,WAAW,GAAGJ,KAAK,CAACK,GAAN,CAAWC,IAAD,IAAUA,IAAI,CAACH,MAAzB,CAApB;AAEA,UAAII,QAAQ,GAAG,EAAf;AACA,YAAMC,UAAU,GAAG,KAAKX,KAAL,CAAWW,UAAX,CAAsBC,OAAtB,CAA8B,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACvD,YAAIC,SAAS,GAAG,EAAE,GAAGF;AAAL,SAAhB;AACA,YAAI;AAAEG,UAAAA,SAAF;AAAaC,UAAAA,SAAb;AAAwBC,UAAAA,OAAxB;AAAiCC,UAAAA;AAAjC,YAA6CJ,SAAjD;AACA,YAAIC,SAAS,IAAIX,QAAjB,EAA2B,OAAO,EAAP;;AAC3B,YAAIa,OAAO,IAAIb,QAAf,EAAyB;AACrBa,UAAAA,OAAO,GAAGb,QAAQ,GAAG,CAArB;AACAc,UAAAA,OAAO,GAAGZ,WAAW,CAACW,OAAD,CAArB;AACH;;AACD,YAAIF,SAAS,KAAKE,OAAlB,EAA2B;AACvB;AACA,cAAID,SAAS,IAAIV,WAAW,CAACS,SAAD,CAA5B,EAAyC;AACrCN,YAAAA,QAAQ,CAACU,OAAT,CAAiBN,CAAjB;AACA,mBAAO,EAAP;AACH,WALsB,CAMvB;;;AACA,cAAIK,OAAO,IAAIZ,WAAW,CAACW,OAAD,CAA1B,EAAqC;AACjCH,YAAAA,SAAS,CAAC,SAAD,CAAT,GAAuBR,WAAW,CAACW,OAAD,CAAlC;AACH;;AACD,iBAAO,CAACH,SAAD,CAAP;AACH;;AACD,YAAIE,SAAS,IAAIV,WAAW,CAACS,SAAD,CAA5B,EAAyC;AACrC;AACA,aAAG;AACCA,YAAAA,SAAS;AACZ,WAFD,QAEST,WAAW,CAACS,SAAD,CAAX,KAA2B,CAFpC;;AAGA,cAAIA,SAAS,IAAIX,QAAjB,EAA2B,OAAO,EAAP;AAC3BY,UAAAA,SAAS,GAAG,CAAZ;AACH;;AACD,YAAIE,OAAO,GAAGZ,WAAW,CAACW,OAAD,CAAzB,EAAoC;AAChC;AACA,iBAAOX,WAAW,CAACW,OAAD,CAAX,KAAyB,CAAhC,EAAmC;AAC/BA,YAAAA,OAAO;AACV;;AACD,cAAIA,OAAO,GAAG,CAAd,EAAiB,OAAO,EAAP;AACjBC,UAAAA,OAAO,GAAGZ,WAAW,CAACW,OAAD,CAArB;AACH;;AACD,YAAIF,SAAS,GAAGE,OAAhB,EAAyB,OAAO,EAAP;AACzBG,QAAAA,MAAM,CAACC,MAAP,CAAcP,SAAd,EAAyB;AACrBC,UAAAA,SADqB;AAErBC,UAAAA,SAFqB;AAGrBC,UAAAA,OAHqB;AAIrBC,UAAAA;AAJqB,SAAzB;AAMA,eAAO,CAACJ,SAAD,CAAP;AACH,OA5CkB,CAAnB;AA8CA,WAAKtB,QAAL,CAAc;AAAES,QAAAA,IAAF;AAAQS,QAAAA;AAAR,OAAd;AACH,KAhIkB;;AAAA,SAkInBY,kBAlImB,GAkIE,CAACC,QAAD,EAAWT,SAAX,KAAyB;AAC1C,UAAIJ,UAAU,GAAG,CAAC,GAAG,KAAKX,KAAL,CAAWW,UAAf,CAAjB;AACAA,MAAAA,UAAU,CAACc,IAAX,CAAgBV,SAAhB;AACA,WAAKtB,QAAL,CAAc;AAAEkB,QAAAA;AAAF,OAAd;AACH,KAtIkB;;AAAA,SAwInBe,qBAxImB,GAwIK,MAAM;AAC1B,WAAKjC,QAAL,CAAc;AAAEkB,QAAAA,UAAU,EAAE;AAAd,OAAd;AACH,KA1IkB;;AAAA,SA4InBgB,yBA5ImB,GA4IS,CAACC,KAAD,EAAQC,IAAR,KAAiB;AACzC,UAAIlB,UAAU,GAAG,CAAC,GAAG,KAAKX,KAAL,CAAWW,UAAf,CAAjB;AACAA,MAAAA,UAAU,CAACiB,KAAD,CAAV,CAAkB,MAAlB,IAA4BC,IAA5B;AACA,WAAKpC,QAAL,CAAc;AAAEkB,QAAAA;AAAF,OAAd;AACH,KAhJkB;;AAAA,SAkJnBmB,qBAlJmB,GAkJK,CAACN,QAAD,EAAWO,cAAX,KAA8B;AAClD,UAAIpB,UAAU,GAAG,CAAC,GAAG,KAAKX,KAAL,CAAWW,UAAf,CAAjB;AACAA,MAAAA,UAAU,CAACqB,MAAX,CAAkBD,cAAlB,EAAkC,CAAlC;AACA,WAAKtC,QAAL,CAAc;AAAEkB,QAAAA;AAAF,OAAd;AACH,KAtJkB;;AAAA,SAwJnBsB,qBAxJmB,GAwJK,MAAM;AAC1B,UAAIC,aAAa,GAAG,CAAC,GAAG,KAAKlC,KAAL,CAAWkC,aAAf,CAApB;AACAA,MAAAA,aAAa,CAACT,IAAd,CAAmB,EAAnB;AACA,WAAKhC,QAAL,CAAc;AAAEyC,QAAAA;AAAF,OAAd;AACH,KA5JkB;;AAAA,SA8JnBC,wBA9JmB,GA8JQ,CAACP,KAAD,EAAQQ,YAAR,KAAyB;AAChD,UAAIF,aAAa,GAAG,CAAC,GAAG,KAAKlC,KAAL,CAAWkC,aAAf,CAApB;AACAA,MAAAA,aAAa,CAACN,KAAD,CAAb,GAAuBQ,YAAvB;AACA,WAAK3C,QAAL,CAAc;AAAEyC,QAAAA;AAAF,OAAd;AACH,KAlKkB;;AAAA,SAoKnBG,wBApKmB,GAoKST,KAAD,IAAW;AAClC,UAAIM,aAAa,GAAG,CAAC,GAAG,KAAKlC,KAAL,CAAWkC,aAAf,CAApB;AACAA,MAAAA,aAAa,CAACF,MAAd,CAAqBJ,KAArB,EAA4B,CAA5B;AACA,UAAIU,WAAW,GAAG;AAAEJ,QAAAA;AAAF,OAAlB;;AACA,UAAIN,KAAK,KAAK,KAAK5B,KAAL,CAAWuC,OAAzB,EAAkC;AAC9B;AACAD,QAAAA,WAAW,CAAC,SAAD,CAAX,GAAyB,IAAzB;AACH,OAHD,MAGO,IAAIV,KAAK,GAAG,KAAK5B,KAAL,CAAWuC,OAAvB,EAAgC;AACnC;AACAD,QAAAA,WAAW,CAAC,SAAD,CAAX,GAAyB,KAAKtC,KAAL,CAAWuC,OAAX,GAAqB,CAA9C;AACH;;AACD,WAAK9C,QAAL,CAAc6C,WAAd;AACH,KAhLkB;;AAAA,SAkLnBE,4BAlLmB,GAkLaZ,KAAD,IAAW;AACtC,WAAKnC,QAAL,CAAc;AAAE8C,QAAAA,OAAO,EAAEX;AAAX,OAAd;AACH,KApLkB;;AAAA,SAsLnBa,mBAtLmB,GAsLG,MAAM;AACxB,UAAIC,MAAM,GAAG,CAAC,GAAG,KAAK1C,KAAL,CAAW0C,MAAf,CAAb;AACAA,MAAAA,MAAM,CAACjB,IAAP,CAAY;AAAEkB,QAAAA,MAAM,EAAE,CAAV;AAAad,QAAAA,IAAI,EAAE;AAAnB,OAAZ;AACA,WAAKpC,QAAL,CAAc;AAAEiD,QAAAA;AAAF,OAAd;AACH,KA1LkB;;AAAA,SA4LnBE,4BA5LmB,GA4LY,CAAChB,KAAD,EAAQe,MAAR,KAAmB;AAC9C,UAAID,MAAM,GAAG,CAAC,GAAG,KAAK1C,KAAL,CAAW0C,MAAf,CAAb;AACA,UAAIG,UAAU,GAAG,EAAE,GAAGH,MAAM,CAACd,KAAD;AAAX,OAAjB;AACA,UAAIkB,SAAS,GAAGC,QAAQ,CAACJ,MAAD,CAAxB;;AACA,UAAIK,KAAK,CAACF,SAAD,CAAT,EAAsB;AAClBA,QAAAA,SAAS,GAAG,CAAZ;AACH;;AACDD,MAAAA,UAAU,CAAC,QAAD,CAAV,GAAuBC,SAAvB;AACAJ,MAAAA,MAAM,CAACd,KAAD,CAAN,GAAgBiB,UAAhB;AACA,WAAKpD,QAAL,CAAc;AAAEiD,QAAAA;AAAF,OAAd;AACH,KAtMkB;;AAAA,SAwMnBO,0BAxMmB,GAwMU,CAACrB,KAAD,EAAQC,IAAR,KAAiB;AAC1C,UAAIa,MAAM,GAAG,CAAC,GAAG,KAAK1C,KAAL,CAAW0C,MAAf,CAAb;AACA,UAAIG,UAAU,GAAG,EAAE,GAAGH,MAAM,CAACd,KAAD;AAAX,OAAjB;AACAiB,MAAAA,UAAU,CAAC,MAAD,CAAV,GAAqBhB,IAArB;AACAa,MAAAA,MAAM,CAACd,KAAD,CAAN,GAAgBiB,UAAhB;AACA,WAAKpD,QAAL,CAAc;AAAEiD,QAAAA;AAAF,OAAd;AACH,KA9MkB;;AAAA,SAgNnBQ,sBAhNmB,GAgNOtB,KAAD,IAAW;AAChC,UAAIc,MAAM,GAAG,CAAC,GAAG,KAAK1C,KAAL,CAAW0C,MAAf,CAAb;AACAA,MAAAA,MAAM,CAACV,MAAP,CAAcJ,KAAd,EAAqB,CAArB;AACA,WAAKnC,QAAL,CAAc;AAAEiD,QAAAA;AAAF,OAAd;AACH,KApNkB;;AAAA,SAsNnBS,YAtNmB,GAsNJ,MAAM;AACjB,WAAK7D,KAAL,CAAW8D,OAAX,CAAmBC,MAAnB;AACH,KAxNkB;;AAAA,SA0NnBC,QA1NmB,GA0NP9B,QAAD,IAAc;AACrB,UAAI+B,SAAS,GAAG,IAAhB;;AAEA,eAASC,QAAT,CAAkBC,SAAlB,EAA6BC,OAA7B,EAAsC;AAClCC,QAAAA,QAAQ,CACHC,cADL,CACoBH,SADpB,EAEKI,SAFL,CAEeC,MAFf,CAEsB,YAFtB,EAEoC,CAACJ,OAFrC;AAGA,YAAI,CAACA,OAAL,EAAcH,SAAS,GAAG,KAAZ;AACjB;;AAEDC,MAAAA,QAAQ,CAAC,oBAAD,EAAuBhC,QAAQ,CAAC1B,YAAT,CAAsBQ,MAAtB,GAA+B,CAAtD,CAAR;;AACA,UAAIkB,QAAQ,CAAC9B,YAAb,EAA2B;AACvB8D,QAAAA,QAAQ,CAAC,oBAAD,EAAuBhC,QAAQ,CAACtB,IAAT,CAAcI,MAAd,GAAuB,CAA9C,CAAR;AACH;;AACD,UAAIkB,QAAQ,CAAChC,YAAT,KAA0B,iBAA9B,EAAiD;AAC7C,YAAIgC,QAAQ,CAACU,aAAT,CAAuB5B,MAAvB,KAAkC,CAAtC,EAAyC;AACrCkD,UAAAA,QAAQ,CAAC,kBAAD,EAAqB,KAArB,CAAR;AACH,SAFD,MAEO;AACH,cAAIhC,QAAQ,CAACe,OAAT,IAAoB,IAAxB,EAA8B;AAC1BiB,YAAAA,QAAQ,CAAC,0BAAD,EAA6B,KAA7B,CAAR;AACH;;AACDhC,UAAAA,QAAQ,CAACU,aAAT,CAAuB6B,OAAvB,CAA+B,CAAClC,IAAD,EAAOD,KAAP,KAC3B4B,QAAQ,CAAC,sBAAsB5B,KAAvB,EAA8BC,IAAI,CAACvB,MAAL,GAAc,CAA5C,CADZ;AAGH;AACJ,OAXD,MAWO;AACH,YAAIkB,QAAQ,CAACkB,MAAT,CAAgBpC,MAAhB,KAA2B,CAA/B,EAAkC;AAC9BkD,UAAAA,QAAQ,CAAC,sBAAD,EAAyB,KAAzB,CAAR;AACH,SAFD,MAEO;AACHhC,UAAAA,QAAQ,CAACkB,MAAT,CAAgBqB,OAAhB,CAAwB,CAACC,IAAD,EAAOpC,KAAP,KAAiB;AACrC4B,YAAAA,QAAQ,CACJ,iCAAiC5B,KAD7B,EAEJoC,IAAI,CAACrB,MAAL,IAAeqB,IAAI,CAACrB,MAAL,KAAgB,CAF3B,CAAR;AAIAa,YAAAA,QAAQ,CACJ,0BAA0B5B,KADtB,EAEJoC,IAAI,CAACnC,IAAL,CAAUvB,MAAV,GAAmB,CAFf,CAAR;AAIH,WATD;AAUH;AACJ;;AAED,aAAOiD,SAAP;AACH,KArQkB;;AAAA,SAuQnBU,UAvQmB,GAuQN,MAAM;AACf,UAAIzC,QAAQ,GAAG;AACX0C,QAAAA,EAAE,EAAE,KAAKlE,KAAL,CAAWkE,EADJ;AAEXxE,QAAAA,YAAY,EAAE,KAAKM,KAAL,CAAWN,YAFd;AAGXE,QAAAA,cAAc,EAAE,KAAKI,KAAL,CAAWJ,cAHhB;AAIXJ,QAAAA,YAAY,EAAE,KAAKQ,KAAL,CAAWR,YAJd;AAKXM,QAAAA,YAAY,EAAE,KAAKE,KAAL,CAAWF,YALd;AAMXa,QAAAA,UAAU,EAAE,KAAKX,KAAL,CAAWW;AANZ,OAAf;;AAQA,UAAI,KAAKX,KAAL,CAAWN,YAAf,EAA6B;AACzB8B,QAAAA,QAAQ,CAAC,MAAD,CAAR,GAAmB,KAAKxB,KAAL,CAAWE,IAA9B;AACH;;AACD,cAAQ,KAAKF,KAAL,CAAWR,YAAnB;AACI,aAAK,SAAL;AACIgC,UAAAA,QAAQ,CAAC,SAAD,CAAR,GAAsB,KAAKxB,KAAL,CAAWW,UAAX,CAAsBH,GAAtB,CAA0B,MAAM,EAAhC,CAAtB;AACJ;;AACA,aAAK,WAAL;AACIgB,UAAAA,QAAQ,CAAC,QAAD,CAAR,GAAqB,KAAKxB,KAAL,CAAW0C,MAAhC;AACA;;AACJ,aAAK,iBAAL;AACIrB,UAAAA,MAAM,CAACC,MAAP,CAAcE,QAAd,EAAwB;AACpBU,YAAAA,aAAa,EAAE,KAAKlC,KAAL,CAAWkC,aADN;AAEpBK,YAAAA,OAAO,EAAE,KAAKvC,KAAL,CAAWuC;AAFA,WAAxB;AAIA;;AACJ;AACI;AAdR;;AAiBA,UAAI,CAAC,KAAKe,QAAL,CAAc9B,QAAd,CAAL,EAA8B;AAE9BzC,MAAAA,cAAc,CAACyC,QAAD,CAAd;AACA,WAAKlC,KAAL,CAAW8D,OAAX,CAAmB3B,IAAnB,CAAwB,YAAxB;AACH,KAxSkB;;AAEf,SAAKzB,KAAL,GAAa;AACTN,MAAAA,YAAY,EAAE,IADL;AAETC,MAAAA,kBAAkB,EAAE,KAFX;AAGTC,MAAAA,cAAc,EAAE,IAHP;AAITJ,MAAAA,YAAY,EAAE,SAJL;AAKTM,MAAAA,YAAY,EAAE,EALL;AAMTI,MAAAA,IAAI,EAAE,EANG;AAOTS,MAAAA,UAAU,EAAE,EAPH;AAQTuB,MAAAA,aAAa,EAAE,EARN;AASTK,MAAAA,OAAO,EAAE,IATA;AAUTG,MAAAA,MAAM,EAAE;AAVC,KAAb;;AAYA,QAAI,CAACpD,KAAK,CAAC6E,WAAX,EAAwB;AACpB,WAAKnE,KAAL,CAAW,eAAX,IAA8B,IAA9B;AACH;AACJ;;AAEDoE,EAAAA,iBAAiB,GAAG;AAChB,QAAI,CAAC,KAAKpE,KAAL,CAAWqE,aAAhB,EAA+B;AAC/BvF,IAAAA,WAAW,CAAC,KAAKQ,KAAL,CAAWgF,UAAZ,EAAyBC,CAAD,IAAO;AACtC,UAAI,CAACA,CAAL,EAAQ;AACJ,aAAK9E,QAAL,CAAc;AAAE+E,UAAAA,eAAe,EAAE;AAAnB,SAAd;AACA;AACH;;AACD,UAAID,CAAC,CAAC/E,YAAF,KAAmB,iBAAvB,EAA0C;AACtC+E,QAAAA,CAAC,CAAC,oBAAD,CAAD,GAA0B,IAA1B;AACH;;AACDA,MAAAA,CAAC,CAAC,eAAD,CAAD,GAAqB,KAArB;AACA,WAAK9E,QAAL,CAAc8E,CAAd;AACH,KAVU,CAAX;AAWH;;AA0QDE,EAAAA,MAAM,GAAG;AACL,QAAI,KAAKzE,KAAL,CAAWqE,aAAf,EAA8B;AAC1B,0BAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;AACH,KAFD,MAEO,IAAI,KAAKrE,KAAL,CAAWwE,eAAf,EAAgC;AACnC,0BAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;AACH;;AACD,wBACI,QAAC,KAAD,CAAO,QAAP;AAAA,8BACI,QAAC,eAAD;AAAA;AAAA;AAAA;AAAA,cADJ,eAGI;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACI;AAAK,UAAA,SAAS,EAAC,KAAf;AAAA,iCACI;AAAA,sBACK,KAAKlF,KAAL,CAAW6E,WAAX,GACK,cADL,GAEK;AAHV;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBADJ,eAQI;AAAK,UAAA,SAAS,EAAC,KAAf;AAAA,iCACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBARJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAHJ,eAgBI;AACI,QAAA,SAAS,EAAC,WADd;AAEI,QAAA,IAAI,EAAC,OAFT;AAGI,QAAA,KAAK,EAAE;AAAEO,UAAAA,UAAU,EAAE;AAAd,SAHX;AAAA,kBAKK,CAAC,SAAD,EAAY,WAAZ,EAAyB,iBAAzB,EAA4ClE,GAA5C,CACIhB,YAAD,IAAkB;AACd,gBAAMmF,KAAK,GAAG,UAAUnF,YAAY,CAACoF,WAAb,EAAxB;AACA,8BACI,QAAC,KAAD,CAAO,QAAP;AAAA,oCACI;AACI,cAAA,IAAI,EAAC,OADT;AAEI,cAAA,SAAS,EAAC,WAFd;AAGI,cAAA,IAAI,EAAC,eAHT;AAII,cAAA,EAAE,EAAED,KAJR;AAKI,cAAA,OAAO,EACHnF,YAAY,KACZ,KAAKQ,KAAL,CAAWR,YAPnB;AASI,cAAA,QAAQ,EAAE,MACN,KAAKD,kBAAL,CACIC,YADJ;AAVR;AAAA;AAAA;AAAA;AAAA,oBADJ,eAgBI;AACI,cAAA,SAAS,EAAC,yBADd;AAEI,cAAA,OAAO,EAAEmF,KAFb;AAAA,wBAIKnF;AAJL;AAAA;AAAA;AAAA;AAAA,oBAhBJ;AAAA,aAAqBA,YAArB;AAAA;AAAA;AAAA;AAAA,kBADJ;AAyBH,SA5BJ;AALL;AAAA;AAAA;AAAA;AAAA,cAhBJ,eAqDI,QAAC,iBAAD;AACI,QAAA,QAAQ,EAAE,IADd;AAEI,QAAA,QAAQ,EAAE,KAAKQ,KAFnB;AAGI,QAAA,YAAY,EAAE,KAAKH;AAHvB;AAAA;AAAA;AAAA;AAAA,cArDJ,EA2DK,KAAKG,KAAL,CAAWL,kBAAX;AAAA;AACG;AACA;AACI,QAAA,SAAS,EAAC,8BADd;AAEI,QAAA,KAAK,EAAE;AAAE+E,UAAAA,UAAU,EAAE;AAAd,SAFX;AAAA,gCAII;AACI,UAAA,IAAI,EAAC,UADT;AAEI,UAAA,SAAS,EAAC,kBAFd;AAGI,UAAA,EAAE,EAAC,cAHP;AAII,UAAA,cAAc,EAAE,KAAK1E,KAAL,CAAWN,YAJ/B;AAKI,UAAA,QAAQ,EAAE,KAAKK;AALnB;AAAA;AAAA;AAAA;AAAA,gBAJJ,eAWI;AACI,UAAA,SAAS,EAAC,kBADd;AAEI,UAAA,OAAO,EAAC,cAFZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAXJ;AAAA;AAAA;AAAA;AAAA;AAAA,cA7DR,EAgFK,KAAKC,KAAL,CAAWN,YAAX,iBACG,QAAC,SAAD;AACI,QAAA,QAAQ,EAAE,IADd;AAEI,QAAA,QAAQ,EAAE,KAAKM,KAFnB;AAGI,QAAA,YAAY,EAAE,KAAKC,gBAHvB;AAII,QAAA,cAAc,EAAE,KAAKsB,kBAJzB;AAKI,QAAA,iBAAiB,EAAE,KAAKO,qBAL5B;AAMI,QAAA,iBAAiB,EAAE,KAAKJ;AAN5B;AAAA;AAAA;AAAA;AAAA,cAjFR,EA2FK,KAAK1B,KAAL,CAAWJ,cAAX,iBACG,QAAC,WAAD;AACI,QAAA,QAAQ,EAAE,IADd;AAEI,QAAA,QAAQ,EAAE,KAAKI,KAFnB;AAGI,QAAA,iBAAiB,EAAE,KAAK0B,qBAH5B;AAII,QAAA,qBAAqB,EAAE,KAAKC,yBAJhC;AAKI,QAAA,iBAAiB,EAAE,KAAKG,qBAL5B;AAMI,QAAA,iBAAiB,EAAE,KAAKG,qBAN5B;AAOI,QAAA,oBAAoB,EAAE,KAAKE,wBAP/B;AAQI,QAAA,oBAAoB,EAAE,KAAKE,wBAR/B;AASI,QAAA,wBAAwB,EACpB,KAAKG;AAVb;AAAA;AAAA;AAAA;AAAA,cA5FR,EA2GK,KAAKxC,KAAL,CAAWR,YAAX,KAA4B,iBAA5B,iBACG;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACI;AAAK,UAAA,SAAS,EAAC,KAAf;AAAA,iCACI,QAAC,WAAD;AACI,YAAA,QAAQ,EAAE,IADd;AAEI,YAAA,QAAQ,EAAE,KAAKQ,KAFnB;AAGI,YAAA,eAAe,EAAE,KAAKyC,mBAH1B;AAII,YAAA,wBAAwB,EACpB,KAAKG,4BALb;AAOI,YAAA,sBAAsB,EAClB,KAAKK,0BARb;AAUI,YAAA,kBAAkB,EAAE,KAAKC;AAV7B;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBADJ,eAeI;AAAK,UAAA,SAAS,EAAC,KAAf;AAAA,iCACI,QAAC,WAAD;AACI,YAAA,WAAW,EAAE,IADjB;AAEI,YAAA,QAAQ,EAAE,KAAKlD;AAFnB;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBAfJ;AAAA;AAAA;AAAA;AAAA;AAAA,cA5GR,eAoII;AAAA,gCACI;AACI,UAAA,IAAI,EAAC,QADT;AAEI,UAAA,SAAS,EAAC,oBAFd;AAGI,UAAA,OAAO,EAAE,KAAKmD,YAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAQI;AACI,UAAA,IAAI,EAAC,QADT;AAEI,UAAA,SAAS,EAAC,qBAFd;AAGI,UAAA,OAAO,EAAE,KAAKc,UAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBARJ;AAAA;AAAA;AAAA;AAAA;AAAA,cApIJ;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AAuJH;;AAxcoC;;AA2czC,oBAAetF,UAAU,CAACS,gBAAD,CAAzB","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { ResizeTextareas } from \"../shared\";\nimport { getAllQuestions, getQuestion, updateQuestion } from \"../api\";\nimport QuestionTextField from \"./questionTextField\";\nimport CodeField from \"./codeField\";\nimport AnswerField from \"./answerField\";\nimport RubricField from \"./rubricField\";\n\nclass QuestionEditView extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            hasCodeField: true,\n            canToggleCodeField: false,\n            hasAnswerField: true,\n            questionType: \"Comment\",\n            questionText: \"\",\n            code: \"\",\n            highlights: [],\n            answerChoices: [],\n            correct: null,\n            rubric: [],\n        };\n        if (!props.newQuestion) {\n            this.state[\"needsQuestion\"] = true;\n        }\n    }\n\n    componentDidMount() {\n        if (!this.state.needsQuestion) return;\n        getQuestion(this.props.questionId, (q) => {\n            if (!q) {\n                this.setState({ invalidQuestion: true });\n                return;\n            }\n            if (q.questionType === \"Multiple Choice\") {\n                q[\"canToggleCodeField\"] = true;\n            }\n            q[\"needsQuestion\"] = false;\n            this.setState(q);\n        });\n    }\n\n    handleQuestionType = (questionType) => {\n        switch (questionType) {\n            case \"Comment\":\n                this.setState({\n                    questionType,\n                    hasCodeField: true,\n                    canToggleCodeField: false,\n                    hasAnswerField: true,\n                });\n                break;\n            case \"Highlight\":\n                this.setState({\n                    questionType,\n                    hasCodeField: true,\n                    canToggleCodeField: false,\n                    hasAnswerField: false,\n                });\n                break;\n            case \"Multiple Choice\":\n                this.setState({\n                    questionType,\n                    canToggleCodeField: true,\n                    hasAnswerField: true,\n                });\n                break;\n            default:\n                return;\n        }\n    };\n\n    handleTextChange = (questionText) => {\n        this.setState({ questionText });\n    };\n\n    handleToggleCodeField = () => {\n        if (this.state.canToggleCodeField) {\n            this.setState({ hasCodeField: !this.state.hasCodeField });\n        }\n    };\n\n    handleCodeChange = (code) => {\n        // see if any highlights were deleted\n        const lines = code.split(\"\\n\");\n        const numLines = lines.length;\n        const lineLengths = lines.map((line) => line.length);\n\n        let removing = [];\n        const highlights = this.state.highlights.flatMap((h, i) => {\n            let highlight = { ...h };\n            let { startLine, startChar, endLine, endChar } = highlight;\n            if (startLine >= numLines) return [];\n            if (endLine >= numLines) {\n                endLine = numLines - 1;\n                endChar = lineLengths[endLine];\n            }\n            if (startLine === endLine) {\n                // highlight doesn't exist on this line anymore\n                if (startChar >= lineLengths[startLine]) {\n                    removing.unshift(i);\n                    return [];\n                }\n                // the end of the highlight got cut off\n                if (endChar >= lineLengths[endLine]) {\n                    highlight[\"endChar\"] = lineLengths[endLine];\n                }\n                return [highlight];\n            }\n            if (startChar >= lineLengths[startLine]) {\n                // go to start of next non-empty line\n                do {\n                    startLine++;\n                } while (lineLengths[startLine] === 0);\n                if (startLine >= numLines) return [];\n                startChar = 0;\n            }\n            if (endChar > lineLengths[endLine]) {\n                // go to end of last non-empty line\n                while (lineLengths[endLine] === 0) {\n                    endLine--;\n                }\n                if (endLine < 0) return [];\n                endChar = lineLengths[endLine];\n            }\n            if (startLine > endLine) return [];\n            Object.assign(highlight, {\n                startLine,\n                startChar,\n                endLine,\n                endChar,\n            });\n            return [highlight];\n        });\n\n        this.setState({ code, highlights });\n    };\n\n    handleAddHighlight = (question, highlight) => {\n        let highlights = [...this.state.highlights];\n        highlights.push(highlight);\n        this.setState({ highlights });\n    };\n\n    handleClearHighlights = () => {\n        this.setState({ highlights: [] });\n    };\n\n    handleChangeHighlightText = (index, text) => {\n        let highlights = [...this.state.highlights];\n        highlights[index][\"text\"] = text;\n        this.setState({ highlights });\n    };\n\n    handleDeleteHighlight = (question, highlightIndex) => {\n        let highlights = [...this.state.highlights];\n        highlights.splice(highlightIndex, 1);\n        this.setState({ highlights });\n    };\n\n    handleAddAnswerChoice = () => {\n        let answerChoices = [...this.state.answerChoices];\n        answerChoices.push(\"\");\n        this.setState({ answerChoices });\n    };\n\n    handleChangeAnswerChoice = (index, answerChoice) => {\n        let answerChoices = [...this.state.answerChoices];\n        answerChoices[index] = answerChoice;\n        this.setState({ answerChoices });\n    };\n\n    handleDeleteAnswerChoice = (index) => {\n        let answerChoices = [...this.state.answerChoices];\n        answerChoices.splice(index, 1);\n        let stateUpdate = { answerChoices };\n        if (index === this.state.correct) {\n            // deleting the correct choice, so no more correct choice\n            stateUpdate[\"correct\"] = null;\n        } else if (index < this.state.correct) {\n            // deleting one before the correct choice, so shift correct choice up\n            stateUpdate[\"correct\"] = this.state.correct - 1;\n        }\n        this.setState(stateUpdate);\n    };\n\n    handleSetCorrectAnswerChoice = (index) => {\n        this.setState({ correct: index });\n    };\n\n    handleAddRubricItem = () => {\n        let rubric = [...this.state.rubric];\n        rubric.push({ points: 1, text: \"\" });\n        this.setState({ rubric });\n    };\n\n    handleChangeRubricItemPoints = (index, points) => {\n        let rubric = [...this.state.rubric];\n        let rubricItem = { ...rubric[index] };\n        let pointsNum = parseInt(points);\n        if (isNaN(pointsNum)) {\n            pointsNum = 0;\n        }\n        rubricItem[\"points\"] = pointsNum;\n        rubric[index] = rubricItem;\n        this.setState({ rubric });\n    };\n\n    handleChangeRubricItemText = (index, text) => {\n        let rubric = [...this.state.rubric];\n        let rubricItem = { ...rubric[index] };\n        rubricItem[\"text\"] = text;\n        rubric[index] = rubricItem;\n        this.setState({ rubric });\n    };\n\n    handleDeleteRubricItem = (index) => {\n        let rubric = [...this.state.rubric];\n        rubric.splice(index, 1);\n        this.setState({ rubric });\n    };\n\n    handleCancel = () => {\n        this.props.history.goBack();\n    };\n\n    validate = (question) => {\n        let formValid = true;\n\n        function setValid(elementId, isValid) {\n            document\n                .getElementById(elementId)\n                .classList.toggle(\"is-invalid\", !isValid);\n            if (!isValid) formValid = false;\n        }\n\n        setValid(\"question-edit-text\", question.questionText.length > 0);\n        if (question.hasCodeField) {\n            setValid(\"question-edit-code\", question.code.length > 0);\n        }\n        if (question.questionType === \"Multiple Choice\") {\n            if (question.answerChoices.length === 0) {\n                setValid(\"question-edit-mc\", false);\n            } else {\n                if (question.correct == null) {\n                    setValid(\"question-edit-mc-correct\", false);\n                }\n                question.answerChoices.forEach((text, index) =>\n                    setValid(\"question-edit-mc-\" + index, text.length > 0)\n                );\n            }\n        } else {\n            if (question.rubric.length === 0) {\n                setValid(\"question-edit-rubric\", false);\n            } else {\n                question.rubric.forEach((item, index) => {\n                    setValid(\n                        \"question-edit-rubric-points-\" + index,\n                        item.points && item.points !== 0\n                    );\n                    setValid(\n                        \"question-edit-rubric-\" + index,\n                        item.text.length > 0\n                    );\n                });\n            }\n        }\n\n        return formValid;\n    };\n\n    handleSave = () => {\n        let question = {\n            id: this.state.id,\n            hasCodeField: this.state.hasCodeField,\n            hasAnswerField: this.state.hasAnswerField,\n            questionType: this.state.questionType,\n            questionText: this.state.questionText,\n            highlights: this.state.highlights,\n        };\n        if (this.state.hasCodeField) {\n            question[\"code\"] = this.state.code;\n        }\n        switch (this.state.questionType) {\n            case \"Comment\":\n                question[\"answers\"] = this.state.highlights.map(() => \"\");\n            // fall through\n            case \"Highlight\":\n                question[\"rubric\"] = this.state.rubric;\n                break;\n            case \"Multiple Choice\":\n                Object.assign(question, {\n                    answerChoices: this.state.answerChoices,\n                    correct: this.state.correct,\n                });\n                break;\n            default:\n                return;\n        }\n\n        if (!this.validate(question)) return;\n\n        updateQuestion(question);\n        this.props.history.push(\"/questions\");\n    };\n\n    render() {\n        if (this.state.needsQuestion) {\n            return <h1>Loading question...</h1>;\n        } else if (this.state.invalidQuestion) {\n            return <h1>Invalid question</h1>;\n        }\n        return (\n            <React.Fragment>\n                <ResizeTextareas />\n\n                <div className=\"row\">\n                    <div className=\"col\">\n                        <h1>\n                            {this.props.newQuestion\n                                ? \"New Question\"\n                                : \"Edit Question\"}\n                        </h1>\n                    </div>\n                    <div className=\"col\">\n                        <h1>Preview</h1>\n                    </div>\n                </div>\n\n                <div\n                    className=\"btn-group\"\n                    role=\"group\"\n                    style={{ marginLeft: \"10px\" }}\n                >\n                    {[\"Comment\", \"Highlight\", \"Multiple Choice\"].map(\n                        (questionType) => {\n                            const idFor = \"type-\" + questionType.toLowerCase();\n                            return (\n                                <React.Fragment key={questionType}>\n                                    <input\n                                        type=\"radio\"\n                                        className=\"btn-check\"\n                                        name=\"question-type\"\n                                        id={idFor}\n                                        checked={\n                                            questionType ===\n                                            this.state.questionType\n                                        }\n                                        onChange={() =>\n                                            this.handleQuestionType(\n                                                questionType\n                                            )\n                                        }\n                                    />\n                                    <label\n                                        className=\"btn btn-outline-primary\"\n                                        htmlFor={idFor}\n                                    >\n                                        {questionType}\n                                    </label>\n                                </React.Fragment>\n                            );\n                        }\n                    )}\n                </div>\n\n                <QuestionTextField\n                    editMode={true}\n                    question={this.state}\n                    onTextChange={this.handleTextChange}\n                />\n\n                {this.state.canToggleCodeField && (\n                    // todo: can change this into a toggle button instead of a checkbox\n                    <div\n                        className=\"form-check form-check-inline\"\n                        style={{ marginLeft: \"10px\" }}\n                    >\n                        <input\n                            type=\"checkbox\"\n                            className=\"form-check-input\"\n                            id=\"hasCodeField\"\n                            defaultChecked={this.state.hasCodeField}\n                            onChange={this.handleToggleCodeField}\n                        />\n                        <label\n                            className=\"form-check-label\"\n                            htmlFor=\"hasCodeField\"\n                        >\n                            Include code field\n                        </label>\n                    </div>\n                )}\n                {this.state.hasCodeField && (\n                    <CodeField\n                        editMode={true}\n                        question={this.state}\n                        onCodeChange={this.handleCodeChange}\n                        onAddHighlight={this.handleAddHighlight}\n                        onDeleteHighlight={this.handleDeleteHighlight}\n                        onClearHighlights={this.handleClearHighlights}\n                    />\n                )}\n\n                {this.state.hasAnswerField && (\n                    <AnswerField\n                        editMode={true}\n                        question={this.state}\n                        onClearHighlights={this.handleClearHighlights}\n                        onChangeHighlightText={this.handleChangeHighlightText}\n                        onDeleteHighlight={this.handleDeleteHighlight}\n                        onAddAnswerChoice={this.handleAddAnswerChoice}\n                        onChangeAnswerChoice={this.handleChangeAnswerChoice}\n                        onDeleteAnswerChoice={this.handleDeleteAnswerChoice}\n                        onSetCorrectAnswerChoice={\n                            this.handleSetCorrectAnswerChoice\n                        }\n                    />\n                )}\n\n                {this.state.questionType !== \"Multiple Choice\" && (\n                    <div className=\"row\">\n                        <div className=\"col\">\n                            <RubricField\n                                editMode={true}\n                                question={this.state}\n                                onAddRubricItem={this.handleAddRubricItem}\n                                onChangeRubricItemPoints={\n                                    this.handleChangeRubricItemPoints\n                                }\n                                onChangeRubricItemText={\n                                    this.handleChangeRubricItemText\n                                }\n                                onDeleteRubricItem={this.handleDeleteRubricItem}\n                            />\n                        </div>\n                        <div className=\"col\">\n                            <RubricField\n                                previewMode={true}\n                                question={this.state}\n                            />\n                        </div>\n                    </div>\n                )}\n\n                <div>\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-danger m-2\"\n                        onClick={this.handleCancel}\n                    >\n                        Cancel\n                    </button>\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-success m-2\"\n                        onClick={this.handleSave}\n                    >\n                        Save\n                    </button>\n                </div>\n            </React.Fragment>\n        );\n    }\n}\n\nexport default withRouter(QuestionEditView);\n"]},"metadata":{},"sourceType":"module"}